ARG CC=gcc
ARG ENV1=FOOBAR

RUN dnf install -y \
	ccache \
	findutils \
	gcc \
	git \
	iproute \
	iptables \
	libaio-devel \
	libasan \
	libcap-devel \
	libnet-devel \
	libnl3-devel \
	make \
	procps-ng \
	protobuf-c-devel \
	protobuf-devel \
	protobuf-python \
	python \
	python-ipaddr \
	python-yaml \
	tar

COPY . /criu
WORKDIR /criu

ENV CCACHE_DIR=/tmp/.ccache CCACHE_NOCOMPRESS=1 $ENV1=yes
RUN mv .ccache /tmp && make mrproper && ccache -sz  && \
	date && make -j $(nproc) CC="$CC" && date && ccache -s
RUN make -C test/zdtm -j $(nproc)
